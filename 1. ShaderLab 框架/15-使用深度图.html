
<!DOCTYPE HTML>
<html lang="zh-cn" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>1.5 使用深度图 · ShaderLab 开发实战</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="16-特定平台的渲染差异.html" />
    
    
    <link rel="prev" href="14-自定义着色器gui.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="1.0 ShaderLab 框架.html">
            
                <a href="1.0 ShaderLab 框架.html">
            
                    
                    1. ShaderLab 框架
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="第1章-shaderlab-语法.html">
            
                <a href="第1章-shaderlab-语法.html">
            
                    
                    第1章 ShaderLab 语法
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="11-属性（properties）.html">
            
                <a href="11-属性（properties）.html">
            
                    
                    1.1 属性（Properties）
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="12-子着色器（subshader）.html">
            
                <a href="12-子着色器（subshader）.html">
            
                    
                    1.2 子着色器（SubShader）
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.2.1" data-path="121-pass.html">
            
                <a href="121-pass.html">
            
                    
                    1.2.1 Pass
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.2.1.1" data-path="1211-culling--depth-testing.html">
            
                <a href="1211-culling--depth-testing.html">
            
                    
                    1.2.1.1 Culling & Depth Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2.1.2" data-path="1212-blending.html">
            
                <a href="1212-blending.html">
            
                    
                    1.2.1.2 Blending
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2.1.3" data-path="1213-pass-tags.html">
            
                <a href="1213-pass-tags.html">
            
                    
                    1.2.1.3 Pass Tags
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2.1.4" data-path="1214-stencil.html">
            
                <a href="1214-stencil.html">
            
                    
                    1.2.1.4 Stencil
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2.1.5" data-path="1215-name.html">
            
                <a href="1215-name.html">
            
                    
                    1.2.1.5 Name
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2.1.6" data-path="1216-legacy-lightiing.html">
            
                <a href="1216-legacy-lightiing.html">
            
                    
                    1.2.1.6 Legacy Lightiing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2.1.7" data-path="1217-legacy-texture-combiners.html">
            
                <a href="1217-legacy-texture-combiners.html">
            
                    
                    1.2.1.7 Legacy Texture Combiners
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2.1.8" data-path="1218-legacy-alpha-testing.html">
            
                <a href="1218-legacy-alpha-testing.html">
            
                    
                    1.2.1.8 Legacy Alpha Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2.1.9" data-path="1219-legacy-fog.html">
            
                <a href="1219-legacy-fog.html">
            
                    
                    1.2.1.9 Legacy Fog
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2.1.10" data-path="12110-legacy-bindchannels.html">
            
                <a href="12110-legacy-bindchannels.html">
            
                    
                    1.2.1.10 Legacy BindChannels
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.1.2.2" data-path="122-usepass.html">
            
                <a href="122-usepass.html">
            
                    
                    1.2.2 UsePass
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2.3" data-path="123-grabpass.html">
            
                <a href="123-grabpass.html">
            
                    
                    1.2.3 GrabPass
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2.4" data-path="124-subshader-tags.html">
            
                <a href="124-subshader-tags.html">
            
                    
                    1.2.4 SubShader Tags
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="13-回滚语句（fallback）.html">
            
                <a href="13-回滚语句（fallback）.html">
            
                    
                    1.3 回滚语句（Fallback）
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.4" data-path="14-自定义编译器（customeditor）.html">
            
                <a href="14-自定义编译器（customeditor）.html">
            
                    
                    1.4 自定义编译器（CustomEditor）
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.5" data-path="15-其他命令（other-commands）.html">
            
                <a href="15-其他命令（other-commands）.html">
            
                    
                    1.5 其他命令（other commands）
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="第2章-顶点和片段着色器.html">
            
                <a href="第2章-顶点和片段着色器.html">
            
                    
                    第2章 顶点和片段着色器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="11-顶点和片段着色器-举例.html">
            
                <a href="11-顶点和片段着色器-举例.html">
            
                    
                    1.1 顶点和片段着色器 举例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="12-shader-语义（semantics）.html">
            
                <a href="12-shader-语义（semantics）.html">
            
                    
                    1.2 着色器语义
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="13-在-cghlsl-中访问-shader-属性.html">
            
                <a href="13-在-cghlsl-中访问-shader-属性.html">
            
                    
                    1.3 在 Cg\/HLSL 中访问着色器属性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.4" data-path="14-为顶点程序提供顶点数据.html">
            
                <a href="14-为顶点程序提供顶点数据.html">
            
                    
                    1.4 为顶点程序提供顶点数据
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.5" data-path="15-内置-shader-包含的文件.html">
            
                <a href="15-内置-shader-包含的文件.html">
            
                    
                    1.5 内置 Shader 包含的文件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.6" data-path="16-预定义着色器预处理宏.html">
            
                <a href="16-预定义着色器预处理宏.html">
            
                    
                    1.6 预定义着色器预处理宏
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.7" data-path="17-内置的辅助功能.html">
            
                <a href="17-内置的辅助功能.html">
            
                    
                    1.7 内置的辅助功能
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.8" data-path="18-内置的着色器变量.html">
            
                <a href="18-内置的着色器变量.html">
            
                    
                    1.8 内置的着色器变量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.9" data-path="19-制作多个着色程序变体.html">
            
                <a href="19-制作多个着色程序变体.html">
            
                    
                    1.9 制作多个着色程序变体
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.10" data-path="110-glsl-着色器程序.html">
            
                <a href="110-glsl-着色器程序.html">
            
                    
                    1.10 GLSL 着色器程序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.11" data-path="111-unity-中使用的着色器语言.html">
            
                <a href="111-unity-中使用的着色器语言.html">
            
                    
                    1.11 Unity 中使用的着色器语言
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.12" data-path="112-着色器编译目标级别.html">
            
                <a href="112-着色器编译目标级别.html">
            
                    
                    1.12 着色器编译目标级别
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.13" data-path="113-着色器数据类型和精度.html">
            
                <a href="113-着色器数据类型和精度.html">
            
                    
                    1.13 着色器数据类型和精度
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="第3章-表面着色器.html">
            
                <a href="第3章-表面着色器.html">
            
                    
                    第3章 表面着色器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="11-表面着色器举例.html">
            
                <a href="11-表面着色器举例.html">
            
                    
                    1.1 表面着色器举例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="12-自定义光照模型的表面着色器.html">
            
                <a href="12-自定义光照模型的表面着色器.html">
            
                    
                    1.2 自定义光照模型的表面着色器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.3" data-path="13-使用dx11opengl-的表面着色器的细分网格.html">
            
                <a href="13-使用dx11opengl-的表面着色器的细分网格.html">
            
                    
                    1.3 使用DX11\/OpenGL 的表面着色器的细分网格
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="第4章-高级-shaderlab-主题.html">
            
                <a href="第4章-高级-shaderlab-主题.html">
            
                    
                    第4章 高级 ShaderLab 主题
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.4.1" data-path="11-unity-的渲染管线.html">
            
                <a href="11-unity-的渲染管线.html">
            
                    
                    1.1 Unity 的渲染管线
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.2" data-path="12-书写着色器的性能提示.html">
            
                <a href="12-书写着色器的性能提示.html">
            
                    
                    1.2 书写着色器的性能提示
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.3" data-path="13-使用替换的着色器渲染.html">
            
                <a href="13-使用替换的着色器渲染.html">
            
                    
                    1.3 使用替换的着色器渲染
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.4" data-path="14-自定义着色器gui.html">
            
                <a href="14-自定义着色器gui.html">
            
                    
                    1.4 自定义着色器GUI
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.4.5" data-path="15-使用深度图.html">
            
                <a href="15-使用深度图.html">
            
                    
                    1.5 使用深度图
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.6" data-path="16-特定平台的渲染差异.html">
            
                <a href="16-特定平台的渲染差异.html">
            
                    
                    1.6 特定平台的渲染差异
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.7" data-path="17-着色器细节等级.html">
            
                <a href="17-着色器细节等级.html">
            
                    
                    1.7 着色器细节等级
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.8" data-path="18-纹理数组.html">
            
                <a href="18-纹理数组.html">
            
                    
                    1.8 纹理数组
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.9" data-path="19-使用-visual-studio-调试-directx11-着色器.html">
            
                <a href="19-使用-visual-studio-调试-directx11-着色器.html">
            
                    
                    1.9 使用 Visual Studio 调试 DirectX11 着色器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.10" data-path="110-固定功能着色器示例.html">
            
                <a href="110-固定功能着色器示例.html">
            
                    
                    1.10 固定功能着色器示例
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../2. Cg 语法/2.0 Cg 语法.html">
            
                <a href="../2. Cg 语法/2.0 Cg 语法.html">
            
                    
                    2. Cg 语法
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../2. Cg 语法/第1章-简介.html">
            
                <a href="../2. Cg 语法/第1章-简介.html">
            
                    
                    第1章 简介
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../2. Cg 语法/11-什么是-cg.html">
            
                <a href="../2. Cg 语法/11-什么是-cg.html">
            
                    
                    1.1 什么是 Cg
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="../2. Cg 语法/12-顶点、片段和图形流水线.html">
            
                <a href="../2. Cg 语法/12-顶点、片段和图形流水线.html">
            
                    
                    1.2 顶点、片段和图形流水线
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" >
            
                <span>
            
                    
                    第2章 最简单的程序
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" >
            
                <span>
            
                    
                    第3章 参数、纹理和表达式
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" >
            
                <span>
            
                    
                    第4章 变换
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" >
            
                <span>
            
                    
                    第5章 光照
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" >
            
                <span>
            
                    
                    第6章 动画
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" >
            
                <span>
            
                    
                    第7章 环境映射技术
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" >
            
                <span>
            
                    
                    第8章 凹凸映射
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" >
            
                <span>
            
                    
                    第9章 高级论题
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.10" >
            
                <span>
            
                    
                    第10章 Profile 和性能
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../3. ShaderLab 开发实战/3.0 ShaderLab 开发实战.html">
            
                <a href="../3. ShaderLab 开发实战/3.0 ShaderLab 开发实战.html">
            
                    
                    3. ShaderLab 开发实战
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本書使用 GitBook 釋出
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >1.5 使用深度图</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
                                <section class="normal markdown-section">
                                
                                <h2 id="using-depth-textures">Using Depth Textures</h2>
<p>It is possible to create Render Textures where each pixel contains a high-precision Depth value. This is mostly used when some effects need the Scene&#x2019;s Depth to be available (for example, soft particles, screen space ambient occlusion and translucency would all need the Scene&#x2019;s Depth). Image Effects often use Depth Textures too.</p>
<p>Pixel values in the Depth Texture range between 0 and 1, with a non-linear distribution. Precision is usually 32 or 16 bits, depending on configuration and platform used. When reading from the Depth Texture, a high precision value in a range between 0 and 1 is returned. If you need to get distance from the Camera, or an otherwise linear 0&#x2013;1 value, compute that manually using helper macros (see below).</p>
<p>Depth Textures are supported on most modern hardware and graphics APIs. Special requirements are listed below:</p>
<p>Direct3D 11+ (Windows), OpenGL 3+ (Mac/Linux), OpenGL ES 3.0+ (Android/iOS), Metal (iOS) and consoles like PS4/Xbox One all support depth textures.
Direct3D 9 (Windows) requires a graphics driver to support &#x201C;INTZ&#x201D; texture format to get depth textures.
OpenGL ES 2.0 (iOS/Android) requires GL_OES_depth_texture extension to be present.
WebGL requires WEBGL_depth_texture extension.</p>
<h4 id="depth-texture-shader-helper-macros">Depth Texture Shader helper macros</h4>
<p>Most of the time, Depth Texture are used to render Depth from the Camera. The UnityCG.cginc include file contains some macros to deal with the above complexity in this case:</p>
<p><strong>UNITY_TRANSFER_DEPTH(o): </strong>computes eye space depth of the vertex and outputs it in o (which must be a float2). Use it in a vertex program when rendering into a depth texture. On platforms with native depth textures this macro does nothing at all, because Z buffer value is rendered implicitly.</p>
<p><strong>UNITY_OUTPUT_DEPTH(i): </strong>returns eye space depth from i (which must be a float2). Use it in a fragment program when rendering into a depth texture. On platforms with native depth textures this macro always returns zero, because Z buffer value is rendered implicitly.</p>
<p><strong>COMPUTE_EYEDEPTH(i):</strong> computes eye space depth of the vertex and outputs it in o. Use it in a vertex program when not rendering into a depth texture.</p>
<p><strong>DECODE_EYEDEPTH(i)/LinearEyeDepth(i):</strong> given high precision value from depth texture i, returns corresponding eye space depth.</p>
<p><strong>Linear01Depth(i):</strong> given high precision value from depth texture i, returns corresponding linear depth in range between 0 and 1.</p>
<p>Note: On DX11/12, PS4, XboxOne and Metal, the Z buffer range is 1&#x2013;0 and UNITY_REVERSED_Z is defined. On other platforms, the range is 0&#x2013;1.</p>
<p>For example, this shader would render depth of its GameObjects:</p>
<pre><code>Shader &quot;Render Depth&quot; {
    SubShader {
        Tags { &quot;RenderType&quot;=&quot;Opaque&quot; }
        Pass {
            CGPROGRAM

            #pragma vertex vert
            #pragma fragment frag
            #include &quot;UnityCG.cginc&quot;

            struct v2f {
                float4 pos : SV_POSITION;
                float2 depth : TEXCOORD0;
            };

            v2f vert (appdata_base v) {
                v2f o;
                o.pos = UnityObjectToClipPos(v.vertex);
                UNITY_TRANSFER_DEPTH(o.depth);
                return o;
            }

            half4 frag(v2f i) : SV_Target {
                UNITY_OUTPUT_DEPTH(i.depth);
            }
            ENDCG
        }
    }
}
</code></pre><hr>
<h2 id="cameras-depth-texture">Camera&#x2019;s Depth Texture</h2>
<p>A Camera can generate a depth, depth+normals, or motion vector Texture. This is a minimalistic G-buffer Texture that can be used for post-processing effects or to implement custom lighting models (e.g. light pre-pass). It is also possible to build similar textures yourself, using Shader Replacement feature.</p>
<p>The Camera&#x2019;s depth Texture mode can be enabled using Camera.depthTextureMode variable from script.</p>
<p>There are three possible depth texture modes:</p>
<p><strong>DepthTextureMode.Depth:</strong> a depth texture.</p>
<p><strong>DepthTextureMode.DepthNormals:</strong> depth and view space normals packed into one texture.*</p>
<p><strong>DepthTextureMode.MotionVectors: </strong>per-pixel screen space motion of each screen texel for the current frame. Packed into a RG16 texture.
These are flags, so it is possible to specify any combination of the above textures.</p>
<h4 id="depthtexturemodedepth-texture">DepthTextureMode.Depth texture</h4>
<p>This builds a screen-sized depth texture.</p>
<p>Depth texture is rendered using the same shader passes as used for shadow caster rendering (ShadowCaster pass type). So by extension, if a shader does not support shadow casting (i.e. there&#x2019;s no shadow caster pass in the shader or any of the fallbacks), then objects using that shader will not show up in the depth texture.</p>
<p>Make your shader fallback to some other shader that has a shadow casting pass, or</p>
<p>If you&#x2019;re using surface shaders, adding an addshadow directive will make them generate a shadow pass too.
Note that only &#x201C;opaque&#x201D; objects (that which have their materials and shaders setup to use render queue &lt;= 2500) are rendered into the depth texture.</p>
<h4 id="depthtexturemodedepthnormals-texture">DepthTextureMode.DepthNormals texture</h4>
<p>This builds a screen-sized 32 bit (8 bit/channel) texture, where view space normals are encoded into R&amp;G channels, and depth is encoded in B&amp;A channels. Normals are encoded using Stereographic projection, and depth is 16 bit value packed into two 8 bit channels.</p>
<p>UnityCG.cginc include file has a helper function DecodeDepthNormal to decode depth and normal from the encoded pixel value. Returned depth is in 0..1 range.</p>
<p>For examples on how to use the depth and normals texture, please refer to the EdgeDetection image effect in the Shader Replacement example project or Screen Space Ambient Occlusion Image Effect.</p>
<h4 id="depthtexturemodemotionvectors-texture">DepthTextureMode.MotionVectors texture</h4>
<p>This builds a screen-sized RG16 (16-bit float/channel) texture, where screen space pixel motion is encoded into the R&amp;G channels. The pixel motion is encoded in screen UV space.</p>
<p>When sampling from this texture motion from the encoded pixel is returned in a rance of &#x2013;1..1. This will be the UV offset from the last frame to the current frame.</p>
<h4 id="tips--tricks">Tips &amp; Tricks</h4>
<p>Camera inspector indicates when a camera is rendering a depth or a depth+normals texture.</p>
<p>The way that depth textures are requested from the Camera (Camera.depthTextureMode) might mean that after you disable an effect that needed them, the Camera might still continue rendering them. If there are multiple effects present on a Camera, where each of them needs the depth texture, there&#x2019;s no good way to automatically disable depth texture rendering if you disable the individual effects.</p>
<p>When implementing complex Shaders or Image Effects, keep Rendering Differences Between Platforms in mind. In particular, using depth texture in an Image Effect often needs special handling on Direct3D + Anti-Aliasing.</p>
<p>In some cases, the depth texture might come directly from the native Z buffer. If you see artifacts in your depth texture, make sure that the shaders that use it do not write into the Z buffer (use ZWrite Off).</p>
<h4 id="shader-variables">Shader variables</h4>
<p>Depth textures are available for sampling in shaders as global shader properties. By declaring a sampler called _CameraDepthTexture you will be able to sample the main depth texture for the camera.</p>
<p>_CameraDepthTexture always refers to the camera&#x2019;s primary depth texture. By contrast, you can use _LastCameraDepthTexture to refer to the last depth texture rendered by any camera. This could be useful for example if you render a half-resolution depth texture in script using a secondary camera and want to make it available to a post-process shader.</p>
<p>The motion vectors texture (when enabled) is avaialable in Shaders as a global Shader property. By declaring a sampler called &#x2018;_CameraMotionVectorsTexture&#x2019; you can sample the Texture for the curently rendering Camera.</p>
<h4 id="under-the-hood">Under the hood</h4>
<p>Depth textures can come directly from the actual depth buffer, or be rendered in a separate pass, depending on the rendering path used and the hardware. Typically when using Deferred Shading or Legacy Deferred Lighting rendering paths, the depth textures come &#x201C;for free&#x201D; since they are a product of the G-buffer rendering anyway.</p>
<p>When the DepthNormals texture is rendered in a separate pass, this is done through Shader Replacement. Hence it is important to have correct &#x201C;RenderType&#x201D; tag in your shaders.</p>
<p>When enabled, the MotionVectors texture always comes from a extra render pass. Unity will render moving GameObjects into this buffer, and construct their motion from the last frame to the current frame.</p>

                                
                                </section>
                            
                        </div>
                    </div>
                
            </div>

            
                
                <a href="14-自定义着色器gui.html" class="navigation navigation-prev " aria-label="Previous page: 1.4 自定义着色器GUI">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="16-特定平台的渲染差异.html" class="navigation navigation-next " aria-label="Next page: 1.6 特定平台的渲染差异">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"1.5 使用深度图","level":"1.2.4.5","depth":3,"next":{"title":"1.6 特定平台的渲染差异","level":"1.2.4.6","depth":3,"path":"1. ShaderLab 框架/16-特定平台的渲染差异.md","ref":"1. ShaderLab 框架/16-特定平台的渲染差异.md","articles":[]},"previous":{"title":"1.4 自定义着色器GUI","level":"1.2.4.4","depth":3,"path":"1. ShaderLab 框架/14-自定义着色器gui.md","ref":"1. ShaderLab 框架/14-自定义着色器gui.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-search","livereload"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"fontsettings":{"theme":"white","family":"sans","size":2},"livereload":{},"highlight":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","dirction":"沈军","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"ShaderLab 开发实战","language":"zh-cn","gitbook":">=2.0.0","description":"Cg语法及ShaderLab开发实战"},"file":{"path":"1. ShaderLab 框架/15-使用深度图.md","mtime":"2016-12-24T14:45:20.000Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2016-12-24T15:12:46.163Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

